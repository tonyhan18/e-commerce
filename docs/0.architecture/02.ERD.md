# e-커머스 상품 주문 서비스


## 문서 목록

## 목차


## ERD 작성
```mermaid
erDiagram

    사용자 {
        bigint id PK "사용자ID"
        string name "이름"
        string email "이메일"
        datetime created_at "생성일시"
        datetime updated_at "수정일시"
    }

    잔고 {
        bigint id PK "잔고ID"
        bigint user_id FK "사용자ID"
        bigint amount "잔액"
        datetime created_at "생성일시"
        datetime updated_at "수정일시"
    }

    잔고이력 {
        bigint id PK "이력ID"
        bigint balance_id FK "잔고ID"
        bigint user_id FK "사용자ID"
        bigint amount "충전금액"
        bigint before_amount "충전 전 잔액"
        bigint after_amount "충전 후 잔액"
        datetime charged_at "충전일시"
    }

    상품 {
        bigint id PK "상품ID"
        string name "상품명"
        bigint price "가격"
        string status "상태(판매/중지 등)"
        datetime created_at "생성일시"
        datetime updated_at "수정일시"
    }

    재고 {
        bigint id PK "재고ID"
        bigint product_id FK "상품ID"
        int quantity "재고수량"
        datetime updated_at "수정일시"
    }

    쿠폰 {
        bigint id PK "쿠폰ID"
        string name "쿠폰명"
        int discount_amount "할인금액"
        string status "상태(발급가능/종료 등)"
        int total_quantity "총발급수량"
        int issued_quantity "발급된수량"
        datetime valid_from "유효시작일"
        datetime valid_to "유효종료일"
        datetime created_at "생성일시"
    }

    사용자쿠폰 {
        bigint id PK "사용자쿠폰ID"
        bigint user_id FK "사용자ID"
        bigint coupon_id FK "쿠폰ID"
        string status "상태(사용가능/사용됨/만료)"
        datetime issued_at "발급일시"
        datetime used_at "사용일시"
    }

    주문 {
        bigint id PK "주문ID"
        bigint user_id FK "사용자ID"
        bigint total_price "총금액"
        bigint coupon_id FK "쿠폰ID"
        string status "상태(결제완료/취소 등)"
        datetime ordered_at "주문일시"
        datetime created_at "생성일시"
    }

    주문상품 {
        bigint id PK "주문상품ID"
        bigint order_id FK "주문ID"
        bigint product_id FK "상품ID"
        int quantity "수량"
        bigint price "주문당시단가"
    }

    결제 {
        bigint id PK "결제ID"
        bigint order_id FK "주문ID"
        bigint user_id FK "사용자ID"
        bigint amount "결제금액"
        string method "결제수단"
        string status "결제상태"
        datetime paid_at "결제일시"
        datetime created_at "생성일시"
        datetime updated_at "수정일시"
    }

    상품통계 {
        bigint id PK "통계ID"
        bigint product_id FK "상품ID"
        int sales_count "판매수량"
        datetime stat_date "통계일"
        datetime created_at "생성일시"
    }

    %% 관계 정의
    사용자 ||--o{ 잔고 : "1:N"
    사용자 ||--o{ 잔고이력 : "1:N"
    사용자 ||--o{ 사용자쿠폰 : "1:N"
    사용자 ||--o{ 주문 : "1:N"
    사용자 ||--o{ 결제 : "1:N"

    잔고 ||--o{ 잔고이력 : "1:N"

    상품 ||--o{ 재고 : "1:1"
    상품 ||--o{ 주문상품 : "1:N"
    상품 ||--o{ 상품통계 : "1:N"

    쿠폰 ||--o{ 사용자쿠폰 : "1:N"
    쿠폰 ||--o{ 주문 : "1:N"

    주문 ||--o{ 주문상품 : "1:N"
    주문 ||--o{ 결제 : "1:N"

    주문상품 }o--|| 상품 : "N:1"
    주문상품 }o--|| 주문 : "N:1"

    상품통계 }o--|| 상품 : "N:1"
```

## 상태 및 타입 정의 (Status & Type)

### 1. 거래 타입 (TransactionType)

잔고 변동(충전, 사용 등) 이력에 사용되는 거래 타입입니다.

| 값      | 설명         |
|---------|--------------|
| CHARGE  | 잔액 충전    |
| USE     | 잔액 사용    |


---

### 2. 상품 상태 (ProductStatus)

| 값         | 설명         |
|------------|--------------|
| SELLABLE   | 판매 가능    |
| UNSELLABLE | 판매 중지    |

---

### 3. 쿠폰 상태 (CouponStatus)

| 값        | 설명           |
|-----------|----------------|
| PUBLISHABLE  | 발급 가능      |
| ENDED     | 발급 종료      |
| EXPIRED   | 만료           |

---

### 4. 사용자쿠폰 상태 (UserCouponStatus)

| 값        | 설명           |
|-----------|----------------|
| UNUSED | 사용 가능      |
| USED      | 사용 완료      |
| EXPIRED   | 만료           |

---

### 5. 주문 상태 (OrderStatus)

| 값        | 설명           |
|-----------|----------------|
| PAID      | 결제 완료      |
| CANCELLED | 주문 취소      |
| PENDING   | 결제 대기      |

---

### 6. 결제 수단 (PaymentMethod)

| 값      | 설명         |
|---------|--------------|
| BALANCE | 잔고 결제    |
| CARD    | 카드 결제    |
| PG      | 외부 PG사    |

---

### 7. 결제 상태 (PaymentStatus)

| 값        | 설명           |
|-----------|----------------|
| READY   | 결제 준비      |
| WAITING   | 결제 대기      |
| SUCCESS   | 결제 성공      |
| FAILED    | 결제 실패      |
| CANCELLED | 결제 취소      |

---

### 8. 기타 참고

- **거래 타입(TransactionType)**은 잔고이력(충전, 사용, 환불 등)에 필수적으로 사용됩니다.
- **상태/타입 값**은 서비스의 비즈니스 로직과 확장성에 따라 추가/수정될 수 있습니다.
- 실제 구현 시에는 각 언어나 프레임워크의 enum, 상수, 코드 테이블 등으로 관리하면 됩니다.