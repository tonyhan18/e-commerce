# e-커머스 상품 주문 서비스

## 문서 목록

## 목차
1. [개요](#개요)
2. [주요 기능](#주요-기능)
3. [API 명세](#API-명세)
4. [제약 및 고려사항](#제약-및-고려사항)
5. [요구사항 정리 (카테고리별 기능적/비기능적 요구사항)](#요구사항-정리-카테고리별-기능적비기능적-요구사항)
    - [잔고 (Balance)](#잔고-balance)
    - [상품 (Product)](#상품-product)
    - [쿠폰 (Coupon)](#쿠폰-coupon)
    - [주문 및 결제 (Order)](#주문-및-결제-order)
    - [상품 통계 (ProductRank)](#상품-통계-productrank)


## 개요

**e-커머스 상품 주문 서비스**는 사용자가 여러 상품을 선택해 주문하고, 미리 충전한 잔액으로 결제할 수 있는 시스템입니다. 주문 내역을 기반으로 인기 상품 추천 기능도 제공합니다.

---

## 주요 기능

- **잔액 충전/조회:** 사용자 잔액 충전 및 조회
- **상품 조회:** 상품 목록 및 재고 정보 조회
- **선착순 쿠폰:** 쿠폰 발급 및 쿠폰 목록 조회, 주문 시 할인 적용
- **주문/결제:** 상품 주문 및 결제, 외부 데이터 플랫폼으로 주문 정보 전송
- **인기 판매 상품:** 최근 3일간 가장 많이 팔린 상위 5개 상품 정보 제공

---

## API 명세

| 기능             | HTTP Method | Endpoint               | 설명                                |
|------------------|-------------|------------------------|-------------------------------------|
| 잔액 충전        | POST        | `/balance/charge`      | 사용자 잔액 충전                    |
| 잔액 조회        | GET         | `/balance`             | 사용자 잔액 조회                    |
| 상품 조회        | GET         | `/products`            | 상품 목록 및 잔여수량 조회          |
| 쿠폰 발급        | POST        | `/coupons/issue`       | 선착순 쿠폰 발급                    |
| 쿠폰 목록 조회   | GET         | `/coupons`             | 사용자 보유 쿠폰 목록 조회          |
| 주문/결제        | POST        | `/orders`              | 상품 주문 및 결제                   |
| 인기 상품 조회   | GET         | `/products/top`        | 최근 3일간 인기 상품 상위 5개 조회  |

---

## 제약 및 고려사항

- **정확한 재고 관리:** 주문 시점의 재고가 부족하면 주문 불가
- **동시성 처리:** 여러 주문이 동시에 들어와도 잔액 및 재고가 정확하게 처리되어야 함
- **다중 인스턴스 환경:** 여러 인스턴스에서 동작해도 일관성 유지
- **외부 데이터 플랫폼 연동:** 주문 성공 시 주문 정보를 외부로 전송 (Mock/Fake Module 활용 가능)

---

# 요구사항 정리 (카테고리별 기능적/비기능적 요구사항)

## 1. 잔고 (Balance)

### 기능적 요구사항
[ 잔액 조회 ]
- [ ] 잔액이 없다면, 0을 반환한다. (`empty`의 개념)
- [ ] 사용자는 자신의 현재 잔액을 조회할 수 있다.

[ 잔액 충전 ]
- [ ] 사용자는 자신의 잔액을 충전할 수 있다.
- [ ] 충전 금액은 0보다 큰 양수여야 한다. (자연수)
- [ ] 잔고 정보가 존재하지 않으면, 새로 생성 후 충전 금액을 저장한다.
- [ ] 잔고가 이미 존재하면, 기존 금액에 충전 금액을 더하여 업데이트한다.
- [ ] 충전한 금액이 최대 잔액을 설정한다.(초기 1,000만원)
- [ ] 잔액을 충전한다. 
- [ ] 잔액 충전이 완료되면 잔고 이력 테이블에 저장한다.

### 비기능적 요구사항
- [ ] 여러 주문이 동시에 들어와도 잔액이 정확하게 처리되어야 한다. (동시성 제어)
- [ ] 잔액 데이터는 안전하게 저장되고, 트랜잭션이 보장되어야 한다.
- [ ] 사용자 식별 및 인증이 안전하게 이루어져야 한다.

---

## 2. 상품 (Product)

### 기능적 요구사항
- [ ] 사용자는 상품의 ID, 이름, 가격, 잔여수량을 조회할 수 있다.
- [ ] 상품 재고가 부족할 경우 주문이 불가하다.(판매 가능 상품만 조회된다)

### 비기능적 요구사항
- [ ] 조회 시점의 상품별 잔여수량이 정확하게 반영되어야 한다.
- [ ] 재고는 동시 주문 상황에서도 정확하게 관리되어야 한다. (데이터 일관성, 락/트랜잭션 적용)
- [ ] 상품 정보 및 재고 데이터가 안전하게 저장되어야 한다.

---

## 3. 쿠폰 (Coupon)

### 기능적 요구사항
[ 보유 쿠폰 목록 조회 ]
- [ ] 쿠폰 정보 (ID, 쿠폰이름, 할인율, 만료기간) 목록을 조회한다.
- [ ] 이때, 사용가능한 쿠폰 정보를 조회해야 한다. 

[ 선착순 쿠폰 발급 ]
- [ ] 사용자는 선착순으로 할인 쿠폰을 발급받을 수 있다.
- [ ] 이미 발급 받은 쿠폰인지 검증 한다. (쿠폰 중복 발급 검증)
- [ ] 쿠폰은 발급 가능한 상태이여야 한다. (쿠폰 상태 검증) 
- [ ] 쿠폰 발급 가능한 수량이 있어야 한다. (쿠폰 수량 검증) 
- [ ] 현재 일자가 쿠폰 만료일자 이전이여야 한다. (쿠폰 만료 검증)
- [ ] 사용자 식별자와 쿠폰 식별자를 받아 선착순 쿠폰을 발급하여 저장한다.
- [ ] 주문 시 유효한 쿠폰을 제출하면 전체 주문금액에 대해 할인이 적용된다.
- [ ] 쿠폰은 중복 사용이 불가하며, 유효기간 및 조건을 만족해야 한다.

### 비기능적 요구사항
- [ ] 쿠폰 발급은 선착순 조건을 정확히 보장해야 한다. (동시성 처리)
- [ ] 쿠폰 데이터는 안전하게 저장되고, 중복 사용이 불가하도록 일관성이 유지되어야 한다.
- [ ] 쿠폰 관련 API는 응답 속도가 빠르고, 대량 트래픽에도 안정적으로 동작해야 한다.

---

## 4. 주문 및 결제 (Order)

### 기능적 요구사항
[ 주문 생성 ]
- [ ] 사용자는 여러 상품을 선택해 한 번에 주문할 수 있다.
- [ ] 쿠폰 ID 존재 시, 쿠폰이 사용 가능한지 검증한다.
- [ ] 주문 총 금액을 계산한다.

[ 결제 완료 ]
- [ ] 주문 시 충전된 잔액으로 결제가 이루어진다.
- [ ] 결제 성공 시 잔액이 차감되고, 상품 재고가 감소한다.

[외부 플랫폼 주문 전송]
- [ ] 결제 성공 시 주문 정보를 외부 데이터 플랫폼에 실시간 전송한다.

### 비기능적 요구사항
- [ ] 주문/결제 과정에서 트랜잭션 및 동시성 문제가 발생하지 않아야 한다.
- [ ] 주문, 결제, 재고, 잔액 등 관련 데이터의 일관성이 반드시 보장되어야 한다.
- [ ] 외부 데이터 플랫폼 연동 시


---

## 5. 상품 통계 (ProductRank)

### 기능적 요구사항
- [ ] 최근 3일간 가장 많이 팔린 상위 5개 상품 정보를 조회할 수 있다.
- [ ] 인기 상품 통계는 주문 내역을 기반으로 산출한다.

### 비기능적 요구사항
- [ ] 통계 데이터는 배치 스케쥴러로 집계되어야 한다.
- [ ] 대량의 주문 데이터에도 통계 집계가 안정적으로 처리되어야 한다.
- [ ] 성능으로 인한 캐싱도 고려 필요하다.