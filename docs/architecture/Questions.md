# 사용자 테이블에 id를 pk로 쓰는 것보다 이메일을 pk로 쓰는게 좋지 않을까?


이메일을 PK(Primary Key)로 사용하는 것은 대부분의 경우 권장되지 않습니다.
아래는 그 이유와 실무적 권장 사항입니다.

1. 이메일을 PK로 쓰는 것의 문제점
변경 가능성
사용자는 이메일 주소를 변경할 수 있습니다. PK는 레코드의 불변성을 보장해야 하지만, 이메일은 사용자의 요청이나 실수, 도메인 변경 등으로 바뀔 수 있습니다.

외부 시스템 연동
다른 테이블(예: 주문, 잔고 등)에서 사용자와의 관계를 맺을 때, 이메일이 PK면 모든 외래키(FOREIGN KEY)에도 이메일을 저장해야 합니다.
이메일이 변경되면 모든 관련 테이블의 FK도 함께 변경해야 하므로 데이터베이스 무결성과 성능에 큰 부담이 됩니다.

길이와 인덱스 효율성
이메일은 일반적으로 20~50자 이상의 문자열입니다.
PK와 FK로 문자열을 사용하면 인덱스 크기가 커지고, 조인 성능이 저하됩니다.
반면, 숫자형 PK는 훨씬 빠르고 효율적입니다.

중복 가능성
이메일은 고유하게 관리할 수 있지만, 실수로 중복 가입, 탈퇴 후 재가입, 소셜 로그인 등으로 중복 이슈가 발생할 수 있습니다.

2. 실무적 권장 사항
숫자형(자동 증가) id를 PK로 사용

불변성, 성능, 관리 효율성 모두에서 유리합니다.

이메일은 UNIQUE 제약 조건을 걸어 중복만 막고, PK로는 사용하지 않습니다.

이메일은 변경 가능성을 허용

사용자가 이메일을 변경할 수 있도록 설계하고, PK와 분리해 관리합니다.


# 주문 테이블이 사용자쿠폰 테이블이 아닌 쿠폰 테이블을 참조한 이유?
주문 테이블이 **쿠폰 테이블(coupon)**을 참조하는 이유는,
주문에 적용된 쿠폰의 **정책 정보(어떤 종류의 쿠폰이었는지, 할인 금액, 유형 등)**를
직접적으로 참조하기 위함입니다.

주요 이유
정책 정보의 일관성 유지

쿠폰 테이블은 쿠폰의 정책(할인율, 할인금액, 유효기간 등) 정보를 담고 있습니다.

주문 테이블이 쿠폰 테이블을 참조하면, 주문에 사용된 쿠폰 정책을 바로 알 수 있습니다.

예를 들어, "SAVE10" 쿠폰이 여러 주문에서 사용되었을 때, 쿠폰 정책이 변경되면 모든 주문에 자동 반영됩니다.

중복 데이터 최소화

주문마다 쿠폰 정책 정보를 별도로 저장하지 않고, 참조만 하여 중복을 줄입니다.

쿠폰 사용 이력 관리

실제로 쿠폰이 사용된 이력(누가, 언제, 어떤 주문에서 사용했는지)은 사용자쿠폰 테이블(user_coupon)에서 관리할 수 있습니다.

쿠폰을 사용하지 않은 주문은 쿠폰 FK가 NULL이 될 수 있습니다.

단순화된 설계

많은 커머스 서비스에서 주문 테이블은 쿠폰 정책(쿠폰 테이블)을 참조하고,

사용자쿠폰 테이블은 실제 발급/사용 이력을 관리합니다.

이렇게 하면 주문에서 쿠폰 정책과 사용 이력을 분리해 관리할 수 있습니다.

실무적 참고
쿠폰 정책이 변경될 때 주의:
주문 당시의 쿠폰 정책(할인 금액 등)을 주문 테이블에 별도 저장하지 않으면,
쿠폰 정책 변경 시 과거 주문 내역의 할인 정보가 달라질 수 있습니다.
→ 실무에서는 주문 테이블에 쿠폰 정책을 참조(FK)하면서,
할인 금액 등은 주문 테이블에 별도 컬럼으로 저장하는 경우가 많습니다.

사용자쿠폰 테이블만 참조하는 방식:
실사용 이력 추적, 중복 사용 방지, 만료 등은 사용자쿠폰 테이블을
주문과 1:1로 연결(FK)하는 것도 좋은 설계입니다.
하지만 정책 정보 조회는 쿠폰 테이블을 참조하는 것이 편리합니다.

요약:

주문 테이블이 쿠폰 테이블을 참조하는 것은 "주문에 적용된 쿠폰의 정책 정보"를 일관되게 관리하고,
데이터 중복을 줄이기 위함입니다.

실제 사용 이력, 만료, 중복 사용 방지 등은 사용자쿠폰 테이블에서 관리합니다.

실무에서는 두 테이블을 모두 활용하거나, 주문 테이블에 할인 금액을 별도 저장하기도 합니다.