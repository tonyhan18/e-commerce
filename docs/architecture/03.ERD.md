# E-ì»¤ë¨¸ìŠ¤ ì„œë¹„ìŠ¤ ERD

**ğŸ“š ë¬¸ì„œ ëª©ë¡**

+ [1ï¸âƒ£ ìš”êµ¬ì‚¬í•­ ë¶„ì„ ë¬¸ì„œ](00.Requirements.md)
+ [2ï¸âƒ£ ë§ˆì¼ìŠ¤í†¤ ë¬¸ì„œ](01.Milestones.md)
+ 3ï¸âƒ£ ë‹¤ì´ì–´ê·¸ë¨ ë¬¸ì„œ
  + [ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ ë¬¸ì„œ](02-1.SequenceDiagram.md)
  + [ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨ ë¬¸ì„œ](02-2.StateDiagram.md)
+ [4ï¸âƒ£ ERD ë¬¸ì„œ](03.ERD.md)
+ [5ï¸âƒ£ API ëª…ì„¸](04.ApiDocument.md)

---

<!-- TOC -->
* [E-ì»¤ë¨¸ìŠ¤ ì„œë¹„ìŠ¤ ERD](#e-ì»¤ë¨¸ìŠ¤-ì„œë¹„ìŠ¤-erd)
  * [ì˜ë„ (Intent)](#ì˜ë„-intent)
    * [í…Œì´ë¸”ì˜ ê³ ìœ  ì‹ë³„ì êµ¬ì„±](#í…Œì´ë¸”ì˜-ê³ ìœ -ì‹ë³„ì-êµ¬ì„±)
    * [ë™ì‹œì„± ì œì–´ ì»¬ëŸ¼](#ë™ì‹œì„±-ì œì–´-ì»¬ëŸ¼)
    * [Redis ì‚¬ìš©ì§€ì ](#redis-ì‚¬ìš©ì§€ì )
    * [ê´€ë¦¬ì ì„±ê²©ì˜ ìƒíƒœ ì»¬ëŸ¼](#ê´€ë¦¬ì-ì„±ê²©ì˜-ìƒíƒœ-ì»¬ëŸ¼)
  * [ERD ì‘ì„±](#erd-ì‘ì„±)
  * [ìƒíƒœ ë° íƒ€ì… ì •ì˜ (Status & Type)](#ìƒíƒœ-ë°-íƒ€ì…-ì •ì˜-status--type)
    * [ê±°ë˜ íƒ€ì… (transaction_type)](#1-ê±°ë˜-íƒ€ì…-transactiontype)
    * [ìƒí’ˆ ìƒíƒœ (product_status)](#2-ìƒí’ˆ-ìƒíƒœ-productstatus)
    * [ì¿ í° ìƒíƒœ (coupon_status)](#3-ì¿ í°-ìƒíƒœ-couponstatus)
    * [ì‚¬ìš©ìì¿ í° ìƒíƒœ (User_Coupon_Status)](#4-ì‚¬ìš©ìì¿ í°-ìƒíƒœ-usercouponstatus)
    * [ì£¼ë¬¸ ìƒíƒœ (Order_Status)](#5-ì£¼ë¬¸-ìƒíƒœ-orderstatus)
    * [ê²°ì œ ìˆ˜ë‹¨ (Payment_Method)](#6-ê²°ì œ-ìˆ˜ë‹¨-paymentmethod)
    * [ê²°ì œ ìƒíƒœ (Payment_Status)](#7-ê²°ì œ-ìƒíƒœ-paymentstatus)
    * [ê¸°íƒ€ ì°¸ê³ ](#8-ê¸°íƒ€-ì°¸ê³ )
<!-- TOC -->

## ìƒê°&ê³ ë¯¼

### í…Œì´ë¸”ì˜ ê³ ìœ  ì‹ë³„ì êµ¬ì„±

ì”ê³ ì™€ ì‚¬ìš©ì, ìƒí’ˆê³¼ ì¬ê³  í…Œì´ë¸”ì€ 1:1 ê´€ê³„ë¥¼ ë§ºê³  ìˆì–´ í•˜ë‚˜ë¡œ í•©ì¹  ìˆ˜ë„ ì™¸ë˜ í‚¤ë¥¼ ê¸°ë³¸ í‚¤ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë‚˜,
ë„ë©”ì¸ ë…ë¦½ì„±ê³¼ ëª…í™•í•œ ì‹ë³„ì„ ìœ„í•´ ë³„ë„ì˜ ID ì»¬ëŸ¼(ê³ ìœ  ì‹ë³„ì)ì„ ê¸°ë³¸ í‚¤ë¡œ ì„¤ê³„í•˜ì˜€ìŠµë‹ˆë‹¤.
ë˜í•œ ìƒí’ˆê³¼ ì¬ê³  í…Œì´ë¸”ì€ í–¥í›„ ìƒí’ˆì˜ ì˜µì…˜ì´ ì¶”ê°€ë  ê²½ìš° ë„ë©”ì¸ ê´€ì ì—ì„œ ë¶„ë¦¬ê°€ í•„ìš”í•˜ë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.

ë‹¤ë§Œ, ì´ ê²½ìš° ì¡°ì¸ ì‹œ ì¸ë±ìŠ¤ í™œìš©ì´ ì œí•œë˜ì–´ ì¿¼ë¦¬ ì„±ëŠ¥ ì¸¡ë©´ì—ì„œ ë¶ˆë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë™ì‹œì„± ì œì–´ ì»¬ëŸ¼

ì”ê³ ,ì¿ í°,ì¬ê³ ,ì£¼ë¬¸/ê²°ì œëŠ” ë™ì‹œì„± ì œì–´ê°€ í•„ìš”í•œ ì£¼ìš” í…Œì´ë¸”ì…ë‹ˆë‹¤. 
ë™ì‹œ ìš”ì²­ì— ë”°ë¥¸ ë°ì´í„° ì •í•©ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ë˜ëŠ” ë¶„ì‚° ë½ê³¼ ê°™ì€ ë©”ì»¤ë‹ˆì¦˜ì´ í•„ìš”í•©ë‹ˆë‹¤.


### Redis ì‚¬ìš©ì§€ì 
ì•…ì˜ì ì¸ ì‚¬ìš©ìë¡œ ì¸í•´ ì£¼ë¬¸ í…Œì´ë¸”ì˜ ë°ì´í„°ê°€ ë§ì•„ì§ˆê²ƒì„ ì—¼ë ¤í•˜ì—¬ Redisë¥¼ ì‚¬ìš©í•´ ì„ì‹œ ë°ì´í„°ë¥¼ ê°€ì§€ê³  ìˆëŠ”ê²Œ ì¢‹ì„ ìˆ˜ ìˆë‹¤ê³  ìƒê°ì´ ë“­ë‹ˆë‹¤.

### ê´€ë¦¬ì ì„±ê²©ì˜ ìƒíƒœ ì»¬ëŸ¼

ì¿ í° í…Œì´ë¸”ì˜ ìŠ¤í…Œì´í„°ìŠ¤, ìƒí’ˆì˜ ìŠ¤í…Œì´í„°ìŠ¤ë¥¼ ì œì‘í•˜ì—¬ ê´€ë¦¬ìê°€ ì§ì ‘ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•˜ê³ ì í•©ë‹ˆë‹¤.
ë˜í•œ ì£¼ë¬¸ í…Œì´ë¸”ì— ê° ê°œì¸í™”ëœ í…Œì´ë¸”ë³´ë‹¤ëŠ” ê´€ë¦¬ì ì„±ê²©ì˜ í…Œì´ë¸”ì„ ë¬¶ëŠ” ê²ƒì´ í–¥í›„ ì •ì±…/ê´€ë¦¬ ì¸¡ë©´ì—ì„œ ìœ ë¦¬í•˜ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.
ìœ„ì˜ ìƒíƒœ ì»¬ëŸ¼ì€ [ìƒíƒœ ë° íƒ€ì… ì •ì˜ (Status & Type)](#ìƒíƒœ-ë°-íƒ€ì…-ì •ì˜-status--type) ê°’ ë“¤ë¡œ ê´€ë¦¬ë©ë‹ˆë‹¤.

## ERD ì‘ì„±
```mermaid
erDiagram

    ì‚¬ìš©ì {
        bigint user_id PK "ì‚¬ìš©ìID"
        varchar nickname "ì´ë¦„"
        datetime created_at "ìƒì„±ì¼ì‹œ"
        datetime updated_at "ìˆ˜ì •ì¼ì‹œ"
    }

    ì”ê³  {
        bigint balance_id PK "ì”ê³ ID"
        bigint user_id FK "ì‚¬ìš©ìID"
        bigint amount "ì”ì•¡"
        datetime created_at "ìƒì„±ì¼ì‹œ"
        datetime updated_at "ìˆ˜ì •ì¼ì‹œ"
    }

    ì”ê³ ì´ë ¥ {
        bigint transaction_id PK "ì´ë ¥ID"
        bigint balance_id FK "ì”ê³ ID"
        bigint user_id FK "ì‚¬ìš©ìID"
        varchar transaction_type "ê±°ë˜ íƒ€ì…"
        bigint amount "ê±°ë˜ê¸ˆì•¡"
        bigint before_amount "ê±°ë˜ ì „ ì”ì•¡"
        bigint after_amount "ê±°ë˜ í›„ ì”ì•¡"
        datetime charged_at "ê±°ë˜ì¼ì‹œ"
    }

    ìƒí’ˆ {
        bigint product_id PK "ìƒí’ˆID"
        varchar name "ìƒí’ˆëª…"
        bigint price "ê°€ê²©"
        varchar status "ìƒíƒœ(íŒë§¤/ì¤‘ì§€ ë“±)"
        datetime created_at "ìƒì„±ì¼ì‹œ"
        datetime updated_at "ìˆ˜ì •ì¼ì‹œ"
    }

    ì¬ê³  {
        bigint stock_id PK "ì¬ê³ ID"
        bigint product_id FK, UK "ìƒí’ˆID"
        int quantity "ì¬ê³ ìˆ˜ëŸ‰"
        datetime updated_at "ìˆ˜ì •ì¼ì‹œ"
    }

    ì¿ í° {
        bigint coupon_id PK "ì¿ í°ID"
        varchar coupon_name "ì¿ í°ëª…"
        varchar status "ìƒíƒœ(ë°œê¸‰ê°€ëŠ¥/ì¢…ë£Œ ë“±)"
        int discount_amount "í• ì¸ê¸ˆì•¡"
        int total_quantity "ì´ë°œê¸‰ìˆ˜ëŸ‰"
        int issued_quantity "ë°œê¸‰ëœìˆ˜ëŸ‰"
        datetime valid_from "ìœ íš¨ì‹œì‘ì¼"
        datetime valid_to "ìœ íš¨ì¢…ë£Œì¼"
        datetime created_at "ìƒì„±ì¼ì‹œ"
    }

    ì‚¬ìš©ìì¿ í° {
        bigint user_coupon_id PK "ì‚¬ìš©ìì¿ í°ID"
        bigint user_id FK "ì‚¬ìš©ìID"
        bigint coupon_id FK "ì¿ í°ID"
        varchar status "ìƒíƒœ(ì‚¬ìš©ê°€ëŠ¥/ì‚¬ìš©ë¨/ë§Œë£Œ)"
        datetime issued_at "ë°œê¸‰ì¼ì‹œ"
        datetime used_at "ì‚¬ìš©ì¼ì‹œ"
    }

    ì£¼ë¬¸ {
        bigint order_id PK "ì£¼ë¬¸ID"
        bigint user_id FK "ì‚¬ìš©ìID"
        bigint coupon_id FK "ì¿ í°ID"
        bigint total_price "ì´ê¸ˆì•¡"
        varchar order_status "ìƒíƒœ(ê²°ì œì™„ë£Œ/ì·¨ì†Œ ë“±)"
        datetime ordered_at "ì£¼ë¬¸ì¼ì‹œ"
        datetime created_at "ìƒì„±ì¼ì‹œ"
    }

    ì£¼ë¬¸ìƒí’ˆ {
        bigint order_product_id PK "ì£¼ë¬¸ìƒí’ˆID"
        bigint order_id FK "ì£¼ë¬¸ID"
        bigint product_id FK "ìƒí’ˆID"
        int quantity "ìˆ˜ëŸ‰(êµ¬ì…ê°œìˆ˜)"
        bigint price "ì£¼ë¬¸ë‹¹ì‹œë‹¨ê°€"
    }

    ê²°ì œ {
        bigint payment_id PK "ê²°ì œID"
        bigint order_id FK "ì£¼ë¬¸ID"
        bigint user_id FK "ì‚¬ìš©ìID"
        bigint amount "ê²°ì œê¸ˆì•¡"
        varchar payment_method "ê²°ì œìˆ˜ë‹¨"
        varchar payment_status "ê²°ì œìƒíƒœ"
        datetime paid_at "ê²°ì œì¼ì‹œ"
        datetime created_at "ìƒì„±ì¼ì‹œ"
        datetime updated_at "ìˆ˜ì •ì¼ì‹œ"
    }

    ìƒí’ˆí†µê³„ {
        bigint rank_id PK "í†µê³„ID"
        bigint product_id FK "ìƒí’ˆID"
        varchar rank_type "ë­í‚¹ íƒ€ì…"
        date rank_date "ë­í‚¹ ì¼ì"
        int score "ë­í‚¹ ì ìˆ˜"
        datetime stat_date "í†µê³„ì¼"
        datetime created_at "ìƒì„±ì¼ì‹œ"
    }

    %% ê´€ê³„ ì •ì˜
    ì‚¬ìš©ì ||--o{ ì”ê³  : "1:N"
    ì‚¬ìš©ì ||--o{ ì”ê³ ì´ë ¥ : "1:N"
    ì‚¬ìš©ì ||--o{ ì‚¬ìš©ìì¿ í° : "1:N"
    ì‚¬ìš©ì ||--o{ ì£¼ë¬¸ : "1:N"
    ì‚¬ìš©ì ||--o{ ê²°ì œ : "1:N"

    ì”ê³  ||--o{ ì”ê³ ì´ë ¥ : "1:N"

    ìƒí’ˆ ||--o{ ì¬ê³  : "1:N"
    ìƒí’ˆ ||--o{ ì£¼ë¬¸ìƒí’ˆ : "1:N"
    ìƒí’ˆ ||--o{ ìƒí’ˆí†µê³„ : "1:N"

    ì¿ í° ||--o{ ì‚¬ìš©ìì¿ í° : "1:N"
    ì¿ í° ||--o{ ì£¼ë¬¸ : "1:N"

    ì£¼ë¬¸ ||--o{ ì£¼ë¬¸ìƒí’ˆ : "1:N"
    ì£¼ë¬¸ ||--o| ê²°ì œ : "1:1"

```

## ìƒíƒœ ë° íƒ€ì… ì •ì˜ (Status & Type)

### 1. ê±°ë˜ íƒ€ì… (TransactionType)

ì”ê³  ë³€ë™(ì¶©ì „, ì‚¬ìš© ë“±) ì´ë ¥ì— ì‚¬ìš©ë˜ëŠ” ê±°ë˜ íƒ€ì…ì…ë‹ˆë‹¤.

| ê°’      | ì„¤ëª…         |
|---------|--------------|
| CHARGE  | ì”ì•¡ ì¶©ì „    |
| USE     | ì”ì•¡ ì‚¬ìš©    |


---

### 2. ìƒí’ˆ ìƒíƒœ (ProductStatus)

| ê°’         | ì„¤ëª…         |
|------------|--------------|
| SELLABLE   | íŒë§¤ ê°€ëŠ¥    |
| UNSELLABLE | íŒë§¤ ì¤‘ì§€    |

---

### 3. ì¿ í° ìƒíƒœ (CouponStatus)

| ê°’        | ì„¤ëª…           |
|-----------|----------------|
| PUBLISHABLE  | ë°œê¸‰ ê°€ëŠ¥      |
| ENDED     | ë°œê¸‰ ì¢…ë£Œ      |
| EXPIRED   | ë§Œë£Œ           |

---

### 4. ì‚¬ìš©ìì¿ í° ìƒíƒœ (UserCouponStatus)

| ê°’        | ì„¤ëª…           |
|-----------|----------------|
| UNUSED | ì‚¬ìš© ê°€ëŠ¥      |
| USED      | ì‚¬ìš© ì™„ë£Œ      |
| EXPIRED   | ë§Œë£Œ           |

---

### 5. ì£¼ë¬¸ ìƒíƒœ (OrderStatus)

| ê°’        | ì„¤ëª…           |
|-----------|----------------|
| PAID      | ê²°ì œ ì™„ë£Œ      |
| CANCELLED | ì£¼ë¬¸ ì·¨ì†Œ      |
| PENDING   | ê²°ì œ ëŒ€ê¸°      |

---

### 6. ê²°ì œ ìˆ˜ë‹¨ (PaymentMethod)

| ê°’      | ì„¤ëª…         |
|---------|--------------|
| BALANCE | ì”ê³  ê²°ì œ    |
| CARD    | ì¹´ë“œ ê²°ì œ    |
| PG      | ì™¸ë¶€ PGì‚¬    |

---

### 7. ê²°ì œ ìƒíƒœ (PaymentStatus)

| ê°’        | ì„¤ëª…           |
|-----------|----------------|
| READY   | ê²°ì œ ì¤€ë¹„      |
| WAITING   | ê²°ì œ ëŒ€ê¸°      |
| SUCCESS   | ê²°ì œ ì„±ê³µ      |
| FAILED    | ê²°ì œ ì‹¤íŒ¨      |
| CANCELLED | ê²°ì œ ì·¨ì†Œ      |

---

### 8. ê¸°íƒ€ ì°¸ê³ 

- **ê±°ë˜ íƒ€ì…(TransactionType)**ì€ ì”ê³ ì´ë ¥(ì¶©ì „, ì‚¬ìš©, í™˜ë¶ˆ ë“±)ì— í•„ìˆ˜ì ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.
- **ìƒíƒœ/íƒ€ì… ê°’**ì€ ì„œë¹„ìŠ¤ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ í™•ì¥ì„±ì— ë”°ë¼ ì¶”ê°€/ìˆ˜ì •ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì‹¤ì œ êµ¬í˜„ ì‹œì—ëŠ” ê° ì–¸ì–´ë‚˜ í”„ë ˆì„ì›Œí¬ì˜ enum, ìƒìˆ˜, ì½”ë“œ í…Œì´ë¸” ë“±ìœ¼ë¡œ ê´€ë¦¬í•˜ë©´ ë©ë‹ˆë‹¤.
